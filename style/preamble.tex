\usepackage{mathtools}
\usepackage{amsthm}
\usepackage{stmaryrd}
%\usepackage{mathpartir}
\usepackage{cancel}
\usepackage{extarrows}
\usepackage{graphicx}
\usepackage[iso, english]{isodate}
\usepackage{booktabs}
\usepackage{siunitx}
\usepackage[dvipsnames,svgnames]{xcolor}

\usepackage{etoolbox}
\makeatletter
\newcommand*\NoIndentAfterEnv[1]{%
  \AfterEndEnvironment{#1}{\par\@afterindentfalse\@afterheading}}
\makeatother
\NoIndentAfterEnv{itemize}
\NoIndentAfterEnv{enumerate}
\NoIndentAfterEnv{description}
\NoIndentAfterEnv{quote}
\NoIndentAfterEnv{proof}
\NoIndentAfterEnv{definition}
\NoIndentAfterEnv{example}
\NoIndentAfterEnv{lemma}
\NoIndentAfterEnv{theorem}
\NoIndentAfterEnv{proposition}
\NoIndentAfterEnv{refremark}
\NoIndentAfterEnv{verbatim}
\NoIndentAfterEnv{Shaded}
\NoIndentAfterEnv{tcolorbox}
\NoIndentAfterEnv{align*}

% dummy environment for idea boxes
\newenvironment{idea}{}{}

% load packages for side- and marginnotes earlier than quarto would so that we can adapt their caption style.
\usepackage[font=normalsize]{caption}
\usepackage{subcaption}
\usepackage{sidenotes}
\usepackage{marginnote}
\captionsetup{font=normalsize}
\DeclareCaptionStyle{widefigure}{font=normalsize, margin=.5cm}
%\captionsetup[figure*]{font=normalsize, margin=1cm}

% \usepackage[lined,boxed,commentsnumbered,algo2e]{algorithm2e}
% \SetAlCapSty{textnormal}
% \SetArgSty{textnormal}
% \SetProgSty{textnormal}
% \SetFuncArgSty{textnormal}
% \LinesNumbered
% \DontPrintSemicolon
% \SetKwProg{For}{for}{\string:}{}
% \SetKwProg{Fn}{def}{\string:}{}
% \SetKwProg{While}{while}{\string:}{}
% \SetKwIF{If}{ElseIf}{Else}{if}{\string:}{elif}{else\string:}{}%

\usepackage{adjustbox}
\usepackage{pgf}
\usepackage{pgfplots}
\pgfdeclarelayer{bg}
\pgfsetlayers{bg,main}
\pgfplotsset{compat=1.18}
\usepackage{tikz}
\usetikzlibrary{arrows, automata, positioning, decorations, shapes, shapes.geometric, shapes.multipart, fadings}

\usepackage{fontawesome5}

\usepackage{fontspec}%,unicode-math
\usepackage{newunicodechar}

\newunicodechar{ðŸ‘}{\text{\faIcon{eye}}}
\newunicodechar{ðŸ—²}{\text{\faIcon{bolt}}}
\newunicodechar{âœ”}{\text{\faIcon{check-circle}}}
\newunicodechar{âœ—}{\text{\faIcon{times-circle}}}

% for some reason, otherwise quarto breaks adjustbox, cf. https://tex.stackexchange.com/questions/634099/latex-adjustbox-shrinks-table/634101?noredirect=1#comment1581050_634101
\setkeys{Gin}{width=\linewidth,height=\textheight,keepaspectratio}

\usepackage{titlesec}
\titleformat{\chapter}
  {\raggedright\normalfont\Huge\bfseries}{\thechapter}{1em}{}
\titlespacing*{\chapter}{0pt}{12pt}{24pt}
\patchcmd{\chapter}{\thispagestyle{plain}}{\thispagestyle{empty}}{}{}

\usepackage{fancyhdr}

\definecolor{obsColor}{RGB}{218, 0, 99}
\definecolor{conjColor}{RGB}{242, 75, 42}
\definecolor{mainPosColor}{RGB}{200, 180, 0}
\definecolor{otherPosColor}{RGB}{143, 209, 79}
\definecolor{negObsColor}{RGB}{18, 205, 212}
\definecolor{negsColor}{RGB}{101, 44, 179}

\usepackage{orcidlink}
%\usepackage{libertinus-otf}
% \setmainfont{Libertinus Serif}
% \setsansfont{Libertinus Sans}
% \setmathfont{Libertinus Math}

%\setmathfont{Linux Libertine O}
%\setmathfont[CharacterVariant=1]{NewCMMath-Regular.otf}
%\setmathfont{Latin Modern Math}

% \setmathfont{latinmodern-math.otf}
% \setmathfont{texgyredejavu-math.otf}
% \setmathfont{MathJax_Main}[
%   range={
%    up,it,bfup,bfit,
%   },
% ]
% \setmathfont{MathJax_SansSerif}[
%   range={
%    sfup,sfit,bfsfup,bfsfit,
%   },
% ]
% \setmathfont{MathJax_AMS}[
%   range={
%    bb,bbit,
%   },
% ]
% \setmathfont{MathJax_Script}[
%   range={
%    scr,bfscr,
%   },
% ]
% \setmathfont{MathJax_Typewriter}[
%   range={
%    tt
%   },
% ]
% \setmathfont{MathJax_Caligraphic}[
%   range={
%    cal,bfcal,
%   },
% ]
% \setmathfont{MathJax_Fraktur}[
%   range={
%    frak,bffrak,
%   },
% ]
% \setmathfont{MathJax_Main}[
%   range=up/num,
% ]

% replace some glyphs that seem to be missing from latin modern or strange.. ?!
\setmathfont{Linux Libertine O}[
  range={
    \mdlgblklozenge,
    \smblklozenge,
    \mdblksquare,
    \smblksquare,
    \blacktriangle,
    \blacktriangledown,
    \bigstar,
    \varnothing
  },
]
\setmathfont{STIX Math}[
  range={
    \blacktriangle,
    \blacktriangledown
  },
]

\DeclareMathAlphabet{\mathcal}{OMS}{cmsy}{m}{n}

\usepackage{amssymb}

% add xtwoheadrightarrow that exists in KaTeX but not in standard LaTeX. (from https://tex.stackexchange.com/a/260563)
\newcommand{\xtwoheadrightarrow}[2][]{%
  \xrightarrow[#1]{#2}\mathrel{\mkern-14mu}\rightarrow
}

\makeatletter
\newbox\xrat@below
\newbox\xrat@above
\newcommand{\xrightarrowtail}[2][]{%
  \setbox\xrat@below=\hbox{\ensuremath{\scriptstyle #1}}%
  \setbox\xrat@above=\hbox{\ensuremath{\scriptstyle #2}}%
  \pgfmathsetlengthmacro{\xrat@len}{max(\wd\xrat@below,\wd\xrat@above)+.6em}%
  \mathrel{\tikz [>->,baseline=-.58ex,line width=0.43pt]
                 \draw (0,0) -- node[below=-2pt] {\box\xrat@below}
                                node[above=-2pt] {\box\xrat@above}
                       (\xrat@len,0) ;}}
\makeatother