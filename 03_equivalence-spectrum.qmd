{{< include style/macros.md >}}

# Context: The Spectrum of Equivalences {#sec-spectrum}

## Observable Difference

### Observations as Denotations

::: {#def-observfations}
#### Observations

On a transition system, the possible observations of a stete, $\semanticsobs{\cdot} \colon \states \to \powerset{\hml}$, are defined as:

$$\semanticsobs{p} ≔ \set{φ ∈ \hml \mid p ∈ \semantics{φ}}.$$
:::


::: {#def-obs-difference}
#### Observable Difference

The difference between $p$ and $q$ is defined as:
$$\difference{p}{q} ≔ \semanticsobs{p} \setminus \semanticsobs{q}.$$
:::

::: {#prp-behavioraleq}
### Behavioral preorder and equivalence

Rephrasing @def-distinctions, two states are preordered with respect to a sublogic $\observationsvar{} ⊆ \hml$
$$p \bpreordvar{\observationsvar{}} q ⟺ \difference{p}{q} \cap \observationsvar{} = \varnothing.$$
:::

### Understanding the Equivalence Hierarchy Through Modal Logics

Let us revisit the hierarchy between bisimilarity, similarity, and trace equivalence of Subsection [-@sec-hierarchy-equivalences].
So far, we have only looked into the characterization of bisimilarity through the whole of $\hml$ in @lem-hennessy-milner.

::: {#def-sim-trace-logics}

We define the two $\hml$-sublogics $\observations{T}$ and $\observations{S}$ by the grammars from $φ^\mathrm{T}$ and $φ^\mathrm{S}$.

$$
\begin{array}{rclll}
  φ^\mathrm{T} & \grammardef &
    \hmlobs{α}φ^\mathrm{T}
    & \grammaror & \hmltrue \\
  φ^\mathrm{S} & \grammardef &
    \hmlobs{α}φ^\mathrm{S}
    & \grammaror & \hmland{i}{I}φ^\mathrm{S}_i
\end{array}
$$
:::

Clearly, $\observations{T} \subset \observations{S} \subset \hml$.
So, by @prp-difference-contraposition, the hierarchy of Subsection [-@sec-hierarchy-equivalences] can also be established by the following two characterization lemmas:

::: {#lem-trace-logics}
$p \bpreord{T} q$ precisely if $p \bpreordvar{\observations{T}} q$.
:::

::: {#lem-sim-logics}
$p \bpreord{S} q$ precisely if $p \bpreordvar{\observations{S}} q$.
:::

### Incomparabilities

::: {#def-failures}

We define failure observations $\observations{F}$ by the grammar:

$$
  φ^\mathrm{F} \grammardef
    \hmlobs{α}φ^\mathrm{F}
    \quad\grammaror\quad
    \hmland{i}{I} \hmlneg \hmlobs{α}\hmltrue 
$$
:::

Intuitively, a failure says that we may follow a trace and see which actions are *impossible* at its end.
Clearly, this encompasses what we may observe via traces,
but is something that we cannot observe using simulation.
We consider $\bpreord{F}$ given by $\bpreordvar{\observations{F}}$.

For instance, $\hmlobs{τ}\hmlands\set{\hmlneg\hmlobs{\literal a}\hmltrue} \in \observations{F}$, distinguishes $\literal P$ from $\literal Q$ on @fig-ts-determinism, but $\literal P \bpreord{S} \literal Q$ (cf. @exm-phil-sim).
On the other hand, no failure from $\observations{F}$, distinguishes $\literal Q$ from $\literal P$, but $\literal Q \nbpreord{S} \literal P$.

:::: {#fig-failure-hierarchy .column-margin}
```{mermaid}
  flowchart TD
    B["Bisimilarity"] --> S["Similarity"] --> T["Trace Equivalence"]
    B --> F["Failure Equivalence"] --> T
  ```

  Preorder/equivalence hierarchy.
::::

As a consequence, simulation preorder and failure preorder ar incomparable, that is, neither one implies the other.
The same is true of the equivalences, similarity and failure equivalence.
The situation is summed up by the non-linear hierarchy in @fig-failure-hierarchy.

## The Linear-Time–Branching-Time Spectrum

Van Glabbeek [-@glabbeek2001ltbtsiReport;-@glabbeek1993ltbt] shows how all common equivalences can be understood to be a lattice of sublanguages of $\hml$ and a variant of $\hml$ for equivalences with silent steps.
His hierarchy of equivalences derives from a hierarchy of *notions of observability*.^[In particular, the weak spectrum [@glabbeek1993ltbt] makes this really formal.]

### Observability Lattice

As we will discuss various equivalence spectra (van Glabbeek [-@glabbeek2001ltbtsiReport;-@glabbeek1993ltbt] already gives two different ones), let us first introduce an abstract description of such spectra.

::: {#def-spectrum}
#### Equivalence Spectrum

An *equivalence spectrum* $(\notions, \leq, \observationsvar{N \in \notions})$ consists of

- a set of notions of observability $\notions$,
- a partial order ${\leq} \subseteq \notions \times \notions$, and
- corresponding logics $\observationsvar{N} \colon \powerset{\hml}$ for $N \in \notions$.

It must hold, for any two notions $N,M \in \notions$, that
$$N \leq M \text{ implies } \observationsvar{N} \subseteq \observationsvar{M}.$$
:::

Effectively, we will be working with lattices $(\notions, \leq)$ where there are greatest lower bounds $\glb$ and least upper bounds $\lub$ between elements of $\notions$.

::: {#exm-simple-spectrum}

Consider the notions
$$\notions^\literal{simple} ≔
\powerset{\set{\literal{(\land)}, \literal{(\neg)} }},
$$
ordered by subset inclusion,
and the family of observation languages $\observationsvar{N \in \notions^\literal{simple}}$ given by the family of grammars:

$$
\begin{array}{rcll}
  φ^N & \grammardef & \hmltrue{} & \\
      & \grammaror  & \hmlobs{α}φ^N & \\
      & \grammaror  & \hmland{i}{I}φ^N_i & \text{ if $\literal{(\land)} \in N$} \\
      & \grammaror  & \hmland{i}{I} \hmlneg \hmlobs{α_i}\hmltrue & \text{ if $\literal{(\neg)} \in N$} \\
      & \grammaror  & \hmlneg φ^N & \text{ if $\set{\literal{(\land)}, \literal{(\neg)} } = N$.}
\end{array}
$$

{{<noindent>}} Clearly, $N \subseteq M$ implies $\observationsvar{N} \subseteq \observationsvar{M}$ for $N, M \in \notions^\literal{simple}$.
We obtain the hierarchy of @fig-sample-hierarchy.

:::: {#fig-sample-hierarchy .column-margin}
```{mermaid}
  flowchart TD
    B["Bisimilarity <br> {(∧), (¬)}"] --- S["Similarity <br> {(∧)}"] --- T["Trace Equivalence <br> ∅"]
    B --- F["Failure Equivalence <br> {(¬)}"] --- T
  ```

  Hierarchy of simple notions of equivalence.
::::
:::


### The Strong Spectrum

### Non-Intersectionality

TODO: Incomparability: failure and sim but not bisim, even failure and sim, but not ready sim.

No-lattice of observations! $\observations{S} \cup \observations{F} \neq \observations{RS}$!

Leads to spectroscopy problem...

## Spectroscopy

### The Spectroscopy Problem

### Spectroscopy as Abstract Interpretation

### Complexities

