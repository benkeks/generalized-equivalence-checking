# Spectroscopy of the Strong Equivalence Spectrum {#sec-strong-spectrum}

::: {.content-hidden when-format="pdf"}
{{< include style/macros.md >}}
:::

The energy game approach can in fact be leveraged to solve the spectroscopy problem for the whole of the strong equivalence spectrum.
This chapter showcases the main result of my paper “Process Equivalence Problems as Energy Games” [@bisping2023equivalenceEnergyGames].

The core ingredient of this chapter is a richer energy game, to be presented in @sec-stong-spectro-game.
The bisimulation energy game of @sec-approach is not complex enough to capture all strong equivalences of @sec-spectrum.
It is “too easy” for the attacker in the sense that they can use unbounded conjunctions to account for every transition the defender might choose after each observation.
But the weaker notions of the spectrum heavily limit how many conjunctions may be used to name a distinction!

Our core trick will be to break the link between observations and conjunctions in the game, analogously to the subset construction on finite automata.

::: {#nte-idea-subset-construction .callout-idea .callout-note}
#### Breaking up observations and conjunctions

Linear-time notions can be addressed in the spectroscopy game by interjecting a subset-construction on defender states between moves that correspond to observations and to conjunctions.
:::

This will lead to exponential blow-up.
In @sec-specific-spectro-games, we will discuss how to get rid of the blowup where possible when instantiating the game to decide equivalences individually.

::: {#nte-idea-instance-games .callout-idea .callout-note}
#### Generating equvialence checkers

By instantiating the spectroscopy game with known initial energies and exploiting the supply of conjunction moves, we can derive efficient decision procedures for individual equivalences.
:::

@fig-strong-spectroscopy-big-picture gives an overview of the two routes to decide equivalences collectively and individually we will explore.

::: {#fig-strong-spectroscopy-big-picture}
```tikz
\begin{tikzpicture}[auto,node distance=1.1cm,
  algstep/.style={minimum width=4.3cm, minimum height=1.2cm, draw=gray, rectangle,align=center,rounded corners}]
  \node[algstep, draw] (States) {States $p, q$ in \\ transition system $\system$};
  \node[algstep, draw, right of=States, node distance=8.1cm] (Preorders) {Strong notions that \\ fit to preorder $p$ to $q$};
  \node[algstep, draw, right of=Preorders, node distance=5cm] (IndividualNotion) {Does notion $N$\\ preorder $p$ to $q$?};
  \node[algstep, draw=TealBlue, below of=States, node distance=2.5cm] (EnergyGame) {Strong spectroscopy \\ energy game $\gamespectroscopy^{\system}$};
  \node[algstep, draw=Peach, below of=EnergyGame, node distance=2.5cm] (ReachabilityGame) {Derived reachability \\ game $\mathsf{Reach}(\gamespectroscopy^{\system}, N)$};
  \node[algstep, draw=TealBlue, below of=Preorders, node distance=2.5cm] (AttackerWinningBudgets) {Minimal attacker winning \\ budgets $\attackerwinsmin(\attackerpos{p,\set{q}})$};
  \node[algstep, draw=Peach, below of=AttackerWinningBudgets, node distance=2.5cm] (AttackerWinningReachability) {Defender winning region\\ $(\attackerpos{p,\set{q}}, N) \in \defenderwins$};
  \path
    (States) edge[->, dashed] node {Spectroscopy problem} (Preorders)
    (States) edge[->, draw=TealBlue] node {Definition 5.1} (EnergyGame)
    (AttackerWinningBudgets) edge[->, draw=TealBlue] node[label={[align=center]right:XOR}] {Theorem 5.1} (Preorders)
    (EnergyGame) edge[->, draw=TealBlue] node {Algorithm 4.1} (AttackerWinningBudgets);
  
  \path
    (States) edge[->, dashed, bend left=20] node {$N$-preorder problem} (IndividualNotion)
    (Preorders) edge[->, gray] node {} (IndividualNotion)
    (EnergyGame) edge[->, draw=Peach] node {Definition 5.2} (ReachabilityGame)
    (ReachabilityGame) edge[->, draw=Peach] node {Algorithm 2.1} (AttackerWinningReachability)
    (AttackerWinningReachability.east) edge[->, draw=Peach, bend right=25] node {} (IndividualNotion)
    (AttackerWinningReachability.east) edge[->, draw=TealBlue, dashed, bend right=25] node {} (IndividualNotion);
  
  \node[text=TealBlue, right=2mm of AttackerWinningBudgets] (Sec51) {Section 5.1};
  \node[text=Peach, right=2mm of AttackerWinningReachability] (Sec52) {Section 5.2};

  \node[below=3mm of AttackerWinningReachability] (Phantom) {};
\end{tikzpicture}
```

How we apply the spectroscopy approach to the full strong spectrum.
:::

## The Strong Spectroscopy Game {#sec-stong-spectro-game}

In this section, we examine a game that does not “overlook” trace observations, as the *bisimulation energy game* (@def-bisim-energy-game) does.

:::: {#exm-trace-distinction-bisim-game}

Consider the $\ccs$-processes
$\ccsprefix{\literal{a}} \ccsprefix{\literal{b}} \literal{a}$ and
$\ccsprefix{\literal{a}} (\literal{a} \ccschoice \literal{b})$.
Clearly, only the first one allows the trace observation $\hmlobs{\literal{a}}\hmlobs{\literal{b}}\hmlobs{\literal{a}}$.
Thus, the processes are not bisimilar and can be distinguished in the bisimulation game.
But the bisimulation game formula (cf. @lem-attacks-imply-formulas) derivable from the game would be
$\hmlobs{\literal{a}}\hmlands \set{ \hmlobs{\literal{b}}, \hmlobs{\literal{b}} \hmlands \set{\hmlobs{\literal{a}} }}$, which is not part of trace observations $\observationsvar[\literal{strong}]{(\infty,0,0,0,0,0)}$.
::::

It might be possible to reconstruct trace observations from such tree-like observations as the one of @exm-trace-distinction-bisim-game.
But by the closing arguments of @sec-spectrum-approach-discussion, and also according to @martensGroote2023minimalDistFormulasNP this must inherently be NP-hard.
What we will do instead is adapt the bisimulation game such that it also expresses trace-like distinctions, and precisely counts conjunctions.

### The Spectroscopy Game

The *strong spectroscopy game* is played not on pairs of states, but on a pair of a state and *a set of states*!
@fig-strong-spectroscopy-game gives a graphical representation.
The intuition is that the attacker shows how to construct formulas that distinguish a process $p$ from every $q$ in a set of processes $Q$.
As long as observations happen, the defender is moved to the set of states $Q$ reachable through non-determinism; only at conjunction moves does the defender have to choose a $q \in Q$.
Treating conjunctions more explicitly, will also allow us to track the depth of positive conjuncts in sufficient detail.

::: {#fig-strong-spectroscopy-game fig-pos="th"}

```tikz
\begin{tikzpicture}[>->,shorten <=1pt,shorten >=0.5pt,auto,node distance=2cm,
    rel/.style={dashed,font=\it},
    posStyle/.style={draw, inner sep=1ex,minimum size=1cm,minimum width=2cm,anchor=center,draw,black,fill=gray!5}]
  \node[posStyle, initial, initial text={}]
    (Att){$\attackerpos{p,Q}$};
  \node[ellipse, draw, inner sep=1ex, minimum size=1cm,minimum width=2cm,fill=gray!5]
    (Def) [right = 2.2cm of Att] {$\defenderpos{p,Q \setminus Q_*,Q_*}$};
  \node[posStyle]
    (AttConj) [below right = 1.2cm and 3cm of Att] {$\attackerpos[\land]{p,q}$};
  \node[posStyle, dashed]
    (AttSwap) [right = 3cm of AttConj] {$\attackerpos{q,\{p\}}$};
  \node[posStyle, dashed]
    (AttContinue) [above = 1cm of AttSwap] {$\attackerpos{p,\{q\}}$};
  \node[posStyle, dashed]
    (AttObs) [above = 1cm of AttContinue] {$\attackerpos{p^\prime,Q^\prime}$};
  % \node[posStyle, dashed]
  %   (AttRevival) [below = 1cm of AttSwap] {$\attackerpos{p,Q_*}$};

  \node (Ghost) [below = 1cm of AttSwap] {};

  \path
    (Att) edge[bend left=28]
      node[pos=.3, align=center, label={[label distance=0.0cm]-25:$\textcolor{gray}{\textcolor{obsColor}{-1},0,0,0,0,0}$}] {$p\step{\alpha}p^\prime$\\ $Q\step{\alpha}Q^\prime$} (AttObs)
    (Att) edge
      node[label={[label distance=0cm]-90:$\textcolor{gray}{0,0,0,0,0,0}$}] {$Q_* \subseteq Q$} (Def)
    (Def) edge[bend left=15]
      node[align=right, swap, pos=.1] {$q \in Q \setminus Q_*$\\$\textcolor{gray}{0,\textcolor{conjColor}{-1},0,\updmin{\textcolor{mainPosColor}{3},\textcolor{otherPosColor}{4}},0,0}$} (AttConj)
    (AttConj) edge[bend left=10]
      node[label={[label distance=0.0cm]-75:$\textcolor{gray}{\updmin{\textcolor{obsColor}{1},\textcolor{otherPosColor}{4}},0,0,0,0,0}$}] {} (AttContinue)
    (AttConj) edge[bend right=15]
      node[align=center, label={[label distance=0.0cm]-90:$\textcolor{gray}{\updmin{\textcolor{obsColor}{1},\textcolor{negObsColor}{5}},0,0,0,0,\textcolor{negsColor}{-1}}$}] {} (AttSwap)
    (Def) edge[bend left=10]
      node[align=center, label={[label distance=0.0cm]-30:$\textcolor{gray}{\updmin{\textcolor{obsColor}{1},\textcolor{mainPosColor}{3}},\textcolor{conjColor}{-1},0,0,0,0}$}] {$p' = p$\\$Q'=Q_* \neq \varnothing$} (AttObs);
\end{tikzpicture}

```

Schematic spectroscopy game $\gamespectroscopy$ of @def-strong-spectroscopy-game.
:::

Again, energies limit the syntactic expressiveness of the formulas.

- The first dimension bounds for how many turns the attacker may challenge observations of actions.
- The second dimension limits how often they may use conjunctions to resolve nondeterminism.
- The third, fourth, and fifth dimensions limit how deeply observations may nest underneath a conjunction, where the fifth stands for negated conjuncts, the third for one of the deepest positive conjuncts and the fourth for the other positive conjuncts.
- The last dimension limits how often the attacker may use negations to enforce symmetry by swapping sides.

The moves of the following definition closely match productions in the grammar of observations for the strong spectrum [@def-strong-spectrum].

::: {#def-strong-spectroscopy-game}

For a system $\system=(\states,\actions,\step{})$,
the $6$-dimensional *strong spectroscopy energy game*
$\gamespectroscopy^{\system}=(G,G_{\defender},\gamemoveblank,w)$
consists of

- *attacker positions* $\attackerpos{p,Q} \in G_\attacker$,
- *attacker conjunct positions* $\attackerpos[\land]{p,q} \in G_\attacker$,
- *defender conjunction positions* $\defenderpos{p,Q,Q_*} \in G_\defender$,

where $p, q \in \states$ and $Q, Q_* \in \powerset{\states}$, and six kinds of moves:
$$
\begin{array}{rrcll}
  \textit{observation}
  & \attackerpos{p,Q}
  & \gamemove{-1,0,0,0,0,0}
  & \attackerpos{p', Q'}
  & \text{if $p \step{\alpha} p^\prime$\!, $Q \step{\alpha} Q'$,}
  \\
  \textit{conjunction}
  & \attackerpos{p,Q}
  & \gamemove{0,0,0,0,0,0}
  & \defenderpos{p,Q \setminus Q_*, Q_*}
  & \text{if $Q_* \subseteq Q$,}
  \\
  \textit{conj.~revival}
  & \defenderpos{p,Q,Q_*}
  & \gamemove{\updmin{1,3},-1,0,0,0,0}
  & \attackerpos{p,Q_*}
  & \text{if $Q_* \neq \varnothing$,}
  \\
  \textit{conj.~answer}
  & \defenderpos{p,Q,Q_*}
  & \gamemove{0,-1,0,\updmin{3,4},0,0}
  & \attackerpos[\land]{p,q}
  & \text{if $q \in Q$,}
  \\
  \textit{positive conjunct}
  & \attackerpos[\land]{p,q}
  & \gamemove{\updmin{1,4},0,0,0,0,0}
  & \attackerpos{p,\{q\}},
  & \text{and}
  \\
  \textit{negative conjunct}
  & \attackerpos[\land]{p,q}
  & \gamemove{\updmin{1,5},0,0,0,0,-1}
  & \attackerpos{q,\{p\}}
  & \text{if $p \neq q$.}
    \\
\end{array}
$$
:::

On the processes of @exm-trace-distinction-bisim-game, the attacker would move:
$$
\begin{array}{rcl}
  \attackerpos{\ccsprefix{\literal{a}} \ccsprefix{\literal{b}} \literal{a}, \set{\ccsprefix{\literal{a}} (\literal{a} \ccschoice \literal{b})}}
  & \gamemove{-\unit{1}} &
  \attackerpos{\ccsprefix{\literal{b}} \literal{a}, \set{\literal{a}, \literal{b}}} 
  \\
  & \gamemove{-\unit{1}} &
  \attackerpos{\literal{a}, \set{\ccsnull}}
  \\
  & \gamemove{-\unit{1}} &
  \attackerpos{\ccsnull, \varnothing}
  \\
  & \gamemove{\zerovec} &
  \defenderpos{\ccsnull, \varnothing, \varnothing}
  \; \ngamemoveblank
\end{array}
$$
Thereby the attacker would get the defender stuck on a trace budget of $(3,0,0,0,0,0) \leq (\infty,0,0,0,0,0) = \notionname{T}$.

The handling of conjunctions can be a little more intricate.

::: {#exm-spectroscopy-failure-trace-distinguished}

Let us think back to @exm-failure-trace-distinguished, that is, to $\literal{Q'} := \ccsprefix{\tau} (\ccsprefix{\literal a} \literal a \ccschoice \ccsprefix{\literal b} \literal{b})$,
$\literal{T'_{\tau a a}} := \literal{Q'} \ccschoice \ccsprefix{\tau}\ccsprefix{\literal a} \literal a$, and
$\literal{T'_{\tau a}} := \literal{Q'} \ccschoice \ccsprefix{\tau}\literal a$, where $\literal{T'_{\tau a a}}$ is distinguished from $\literal{T'_{\tau a}}$ by the failure-trace observation $\hmlobs{\tau} \hmlands\set{\hmlobs{\literal a}\hmlobs{\literal{a}}, \hmlneg \hmlobs{\literal b}} \in \observationsvar[\literal{strong}]{(3,1,2,0,1,1)} \subseteq \observations[\literal{strong}]{\literal{FT}}$.

To point out a similar distinction in the spetroscopy game, the attacker moves:
$$
\begin{array}{rcl}
  \attackerpos{\literal{T'_{\tau a a}}, \set{\literal{T'_{\tau a}}}}
  & \gamemove{-\unit{1}} &
  \attackerpos{\ccsprefix{\literal a} \literal a, \set{\literal a, \ccsprefix{\literal a} \literal a \ccschoice \ccsprefix{\literal b} \literal{b}}} \\
  & \gamemove{\zerovec} &
  \defenderpos{\ccsprefix{\literal a} \literal a, \set{\ccsprefix{\literal a} \literal a \ccschoice \ccsprefix{\literal b} \literal{b}}, \set{\literal a}}
\end{array}
$$
Now, the defender has two options.

- If defender chooses conjunction answer $\dots \gamemove{0,-1,0,\updmin{3,4},0,0} \attackerpos[\wedge]{\ccsprefix{\literal a} \literal a, \ccsprefix{\literal a} \literal a \ccschoice \ccsprefix{\literal b} \literal{b}}$, then attacker points out that $\literal b$ is not possible for the left process:
  $$
  \begin{array}{rcl}
    \attackerpos[\wedge]{\ccsprefix{\literal a} \literal a, \ccsprefix{\literal a} \literal a \ccschoice \ccsprefix{\literal b} \literal{b}}
    & \gamemove{\updmin{1,5},0,0,0,0,-1} &
    \attackerpos{ \ccsprefix{\literal a} \literal a \ccschoice \ccsprefix{\literal b} \literal{b}, \set{\ccsprefix{\literal a} \literal a} }\\
    & \gamemove{-\unit{1}} &
    \attackerpos{ \literal{b}, \varnothing }
    \\
    & \gamemove{\zerovec} &
    \defenderpos{\literal{b}, \varnothing, \varnothing}
    \; \ngamemoveblank
  \end{array}
  $$
- If defender opts for a conjunction revival $\dots \gamemove{\updmin{1,3},-1,0,0,0,0} \attackerpos{\ccsprefix{\literal a} \literal a, \set{\literal a}}$, then attacker highlights that the left process can do $\literal a \literal a$:
  $$
  \begin{array}{rcl}
    \attackerpos{\ccsprefix{\literal a} \literal a, \set{\literal a}}
    & \gamemove{-\unit{1}} &
    \attackerpos{ \literal{a}, \set{\ccsnull} }
    \\
    & \gamemove{-\unit{1}} &
    \attackerpos{ \ccsnull, \varnothing }
    \\
    & \gamemove{\zerovec} &
    \defenderpos{\ccsnull, \varnothing, \varnothing}
    \; \ngamemoveblank
  \end{array}
  $$

To win in both cases, the attacker must start with a budget of at least $(3,1,2,0,1,1)$.

The game also allows another path through nested negations that the attacker wins at $(3,2,0,0,2,2)$, but this is not interesting for specific equivalences below bisimilarity.
:::

The spectroscopy game still is a bisimulation game in the following sense.

::: {#lem-spectroscopy-bisimulation-game}
$p_0$ and $q_0$ are bisimilar
iff the defender wins $\gamespectroscopy$ from $\attackerpos{p_0, \{q_0\}}$ with $e_0$ for every initial energy budget $e_0$,
that is, if $(\infty, \infty, \infty, \infty, \infty, \infty) \in \defenderwins(\attackerpos{p_0, \{q_0\}})$.^[
  Proof in Lemma 1 of @bisping2023equivalenceEnergyGamesReport.
]
:::

TODO: Example graph (just the old one?)

### Correctness

To prove correctness, we proceed as with the bisimulation energy game in @sec-correctness-poly-spectroscopy:
On the one hand, we show that game moves correspond to formulas of similar prices and that the attacker winning implies the formulas to be distinguishing.
On the other hand, we establish that formulas of certain expressiveness prices certify winning attacks of matching budgets.

::: {#def-strategy-formulas-poly}
#### Strategy Formulas for $\gamespectroscopy$

The set of *strategy formulas* for a game position $g$ and a budget $e$, $\stratstrong(g, e)$, in the context of a strong spectroscopy game $\gamespectroscopy^{\system}$ is defined inductively by the following rules:
$$
\dfrac{
  \begin{matrix}
    \attackerpos{p,Q} \gamemove{-\unit{1}} \attackerpos{p', Q'} \quad
    e' = \energyupdate(-\unit{1}, e) ∈ \attackerwins^{\gamespectroscopy}(\attackerpos{p', Q'})
    \\
    p \step{\alpha} p' \quad Q \step{\alpha} Q' \quad
    φ ∈ \stratstrong(\attackerpos{p', Q'}, e')
  \end{matrix}
}{
  \hmlobs{α} φ ∈ \stratstrong(\attackerpos{p, q}, e)
}
$$
$$
\dfrac{
  \attackerpos{p,Q} \gamemove{\zerovec} \defenderpos{p, Q', Q_*} \quad
  e ∈ \attackerwins^{\gamespectroscopy}(\defenderpos{p, Q', Q_*}) \quad
  φ ∈ \stratstrong(\defenderpos{p, Q', Q_*}, e)
 }{
  φ ∈ \stratstrong(\attackerpos{p, Q}, e)
}
$$
$$
\dfrac{
  \begin{matrix}
    \defenderpos{p, Q, \varnothing} \gamemove{u_q} \attackerpos[\wedge]{p, q} \quad
    e_q = \energyupdate(u_q, e) ∈ \attackerwins^{\gamespectroscopy}(\attackerpos[\wedge]{p, q})
    \\
    \psi_q ∈ \stratstrong(\attackerpos[\wedge]{p, q}, e_q) \quad
    \text{for each } q ∈ Q
  \end{matrix}
}{
  \hmland{q}{Q} \psi_q ∈ \stratstrong(\defenderpos{p, Q, \varnothing}, e)
}
$$
$$
\dfrac{
  \begin{matrix}
    \defenderpos{p, Q, Q_*} \gamemove{u_q} \attackerpos[\wedge]{p, q} \quad
    e_q = \energyupdate(u_q, e) ∈ \attackerwins^{\gamespectroscopy}(\attackerpos[\wedge]{p, q})
    \\
    \psi_q ∈ \stratstrong(\attackerpos[\wedge]{p, q}, e_q) \quad
    \text{for each } q ∈ Q \text{ and }
    \\
    \defenderpos{p, Q, Q_*} \gamemove{u_*} \attackerpos{p, Q_*} \quad
    e_* = \energyupdate(u_*, e) ∈ \attackerwins^{\gamespectroscopy}(\attackerpos{p, Q_*})
    \\
    \psi_* = \hmlobs{α} φ ∈ \stratstrong(\attackerpos{p, Q_*}, e_*)
  \end{matrix}
}{
  \hmland{q}{Q \cup \set{*}} \psi_q ∈ \stratstrong(\defenderpos{p, Q, Q_*}, e)
}
$$
$$
\dfrac{
  \begin{matrix}
    \attackerpos[\wedge]{p, q} \gamemove{u} \attackerpos{p, \set{q}} \quad
    e' = \energyupdate(u, e) ∈ \attackerwins^{\gamespectroscopy}(\attackerpos{p, \set{q}})
    \\
    \hmlobs{α} φ ∈ \stratstrong(\attackerpos{p, \set{q}}, e')
  \end{matrix}
}{
  \hmlobs{α} φ ∈ \stratstrong(\attackerpos[\wedge]{p, q}, e)
}
$$

$$
\dfrac{
  \begin{matrix}
    \attackerpos[\wedge]{p, q} \gamemove{u} \attackerpos{q, \set{p}} \quad
    e' = \energyupdate(u, e) ∈ \attackerwins^{\gamespectroscopy}(\attackerpos{q, \set{p}})
    \\
    p \neq q \quad
    \hmlobs{α} φ ∈ \stratstrong(\attackerpos{q, \set{p}}, e')
  \end{matrix}
}{
  \hmlneg \hmlobs{α} φ ∈ \stratstrong(\attackerpos[\wedge]{p, q}, e)
}
$$

:::

The base case of the definition is the rule for conjunctions at $\defenderpos{p, \varnothing, \varnothing}$, yielding strategy formula $\hmltrue$, which trivially distinguishes any $p$ from the empty set.

The correctness proof proceeds basically as with the bisimulation energy game, establishing soundness as in @lem-bisim-energy-game-soundness and completeness as in @lem-bisim-energy-game-completeness.
Proofs can be found in @bisping2023equivalenceEnergyGamesReport.
There are two minor definitional nuances between the presentation here and there, upon which we will comment in @rem-differences-paper.

::: {#lem-strong-spectroscopy-game-soundness}
If $e ∈ \attackerwins^{\gamespectroscopy}(\attackerpos{p, Q})$,
then there is $φ ∈ \stratstrong(\attackerpos{p, Q}, e)$ with $φ ∈ \observationsvar[\literal{strong}]{e}$, $p ∈ \semantics{φ}$ and $Q \cap \semantics{φ} = \varnothing$.^[
  Proof in Lemma 2, 3, and 4 of @bisping2023equivalenceEnergyGamesReport.
]
:::

::: {#lem-strong-spectroscopy-game-completeness}
If there is $φ ∈ \observationsvar[\literal{strong}]{e}$ with $p ∈ \semantics{φ}$ and $Q \cap \semantics{φ} = \varnothing$,
then $e ∈ \attackerwins^{\gamespectroscopy}(\attackerpos{p, Q})$.^[
  Proof in Lemma 5 of @bisping2023equivalenceEnergyGamesReport.
]
:::

Taken together, @lem-strong-spectroscopy-game-soundness and @lem-strong-spectroscopy-game-completeness prove that the strong spectroscopy game $\gamespectroscopy$ precisely characterizes the strong equivalence spectrum $\notions^\literal{strong}$.

::: {#thm-strong-spectroscopy-game-characterization}
$p \bpreordvar{\observationsvar{e}} q$ for $e ∈ \notions^\literal{strong}$ precisely if the defender wins $\gamespectroscopy$ from $\attackerpos{p,\set{q}}$ if the attacker starts with budget $e$.
:::

Thus, we can solve the spectroscopy problem of @def-spectroscopy-problem by computing $\notions^\literal{strong}_{p,q} = \notions^\literal{strong} \setminus \attackerwins^{\gamespectroscopy}(\attackerpos{p, \set{q}})$.

:::{#rem-differences-paper}

Conjunction

Expr explicitly defined

:::

### Complexity

As expected, the bigger spectroscopy game leads to exponential runtimes.
This comes as no surprise, for we have already discussed in @sec-equivalence-complexities that the complexity problem on the whole strong spectrum is PSPACE-hard.

::: {#thm-strong-spectroscopy-complexity}
Given a transition system $\system$,
the spectroscopy problem for the $\notions^\literal{strong}$-spectrum can be solved by the game approach in exponential time and space with respect to the state space size $\relsize{\states}$.
:::
:::proof
According to @thm-strong-spectroscopy-game-characterization, we can solve the spectroscopy problem for the $\notions^\literal{strong}$-spectrum by deciding the winning budgets of the strong spectroscopy game ${\gamespectroscopy}^{\system}$ on $\system=(\states,\actions,\step{})$.
We instantiate the winning budget complexity of @lem-declining-update-complexity for the case $N=6$ with the size of $\gamespectroscopy$ according to @def-strong-spectroscopy-game.

The amount of attacker positions is bounded by $\relsize{\states} \cdot 2^{\relsize{\states}}$.
The number of conjunction moves and defender conjunction positions is bounded by $\relsize{\states} \cdot 3^{\relsize{\states}}$.

The maximal out-degree for attacker positions is in $\bigo{2^{\relsize{\states}}}$, which dominates that of defender conjunction positions of $\bigo{\relsize{\states}}$,

This amounts to $o_{\gamemoveblank}$ in $\bigo{2^{\relsize{\states}}}$ and to $\relsize{G_{\triangle}}$ in $\bigo{\relsize{\states} \cdot 3^{\relsize{\states}}}$.

Inserting the parameters in the time bounds of @lem-declining-update-complexity yields:
$$
\begin{array}{rlccccccc}
    & O( & o_{\gamemoveblank} & \cdot & \relsize{G}^{2N} & \cdot & (N^2 + \relsize{G}^{N-1} \cdot N) & ) \\
  = & O( & (2^{\relsize{\states}}) & \cdot & (\relsize{\states} \cdot 3^{\relsize{\states}})^{2 \cdot 6} & \cdot & (6^2 + (\relsize{\states} \cdot 3^{\relsize{\states}})^{6-1} \cdot 6) & ) \\
  = & O( & 2^{\relsize{\states}} & \cdot & \relsize{\states}^{12} \cdot 3^{12\relsize{\states}} & \cdot & \relsize{\states}^5 \cdot 3^{5\relsize{\states}} & ) \\
  = & O( & \relsize{\states}^{17} & \cdot & 2^{\relsize{\states}} \cdot 3^{17\relsize{\states}} & ).
\end{array}
$$
For space complexity, the approach arrives at $\bigo{ \relsize{\states}^6 \cdot 3^{6\relsize{\states}}}$.
:::

Still, there are ways to decrease the complexity of the algorithm and thus increase applicability.
We will explore these in the next section.

## More Specific Games {#sec-specific-spectro-games}

We can exploit properties of the equivalences of the strong spectrum in @fig-strong-ltbt-spectrum we actually care about to focus on simpler variants of the spectroscopy game.

1. Since the specific coordinates in @fig-strong-ltbt-spectrum only use 0, 1, and ∞ in components, we can employ @lem-declining-update-complexity-flattened to slighlty improve complexity bounds.
2. With more specific equivalences in mind, we can also focus on subgraphs of the spectroscopy game $\gamespectroscopy$ in order to obtain better bounds.

We will use both tricks in the “clever” strong spectroscopy game in @sec-clever-strong-spectro.
Then we will take the second point to the extreme by instantiating the spectroscopy game down to only decide single equivalences.

### The Clever Game {#sec-clever-strong-spectro}

We can *become more clever by looking one step ahead*.

The spectroscopy game $\gamespectroscopy$ of @def-strong-spectroscopy-game may branch exponentially with respect to $\relsize{Q}$ at conjunction challenges after $\attackerpos{p,Q}$.
For an efficient implementation, it is desirable to not do that.

Given the spectrum we are interested in, we can drastically limit the sensible attacker moves to four options by a little lookahead into the enabled actions $\initials{q}$ of $q \in Q$ and $\initials{p}$.

In the following, we will focus on the sub-spectrum $\widehat{\notions}^\literal{strong} \subseteq \set{0, 1, \infty}^6 \subseteq \notions^\literal{strong}$, where dimensions 3, 4, and 5 of modal depth for positive and negative conjuncts can only appear in certain combinations.

::: {#def-simpler-strong-spectrum}

The simpler strong spectrum, $\widehat{\notions}^\literal{strong}$, is defined as
$$
\widehat{\notions}^\literal{strong} ≔
  \set{e \in \set{0, 1, \infty}^6 \mid e_4 \leq e_3 \land (e_5 = \infty \longrightarrow e_3 = e_4)}.
$$
:::

Observe that all the coordinates of the strong linear-time–branching-time spectrum (@def-strong-ltbt-spectrum) are still covered by the simpler spectrum.

::: {#def-strong-spectroscopy-game-clever}
#### Clever Spectroscopy Game

The *clever spectroscopy game* $\gamespectroscopyclever$, is defined exactly like the previous spectroscopy game of @def-strong-spectroscopy-game with the restriction of the conjunction challenges
$$
    \attackerpos{p,Q}
    \quad \gamemove{\zerovec}_\blacktriangle
    \quad \defenderpos{p,Q \setminus Q_*, Q_*}
    \quad \text{with } Q_* \subseteq Q,
$$
to situations where
$\; Q_* \in 
    \{ \; \varnothing,\quad
    \{ q \in Q \mid \initials{q} \subseteq \initials{p} \},\quad
    \{ q \in Q \mid \initials{p} \subseteq \initials{q} \},\quad
    \{ q \in Q \mid \initials{p} = \initials{q} \} \; \}.$
:::

::: {#thm-clever-strong-spectroscopy-correctness}
#### Correctness of Cleverness

For $e \in \widehat{\notions}^\literal{strong}$, the attacker wins $\gamespectroscopyclever$ from $\attackerpos{p_0,Q_0}$ with $e$ precisely if they win $\gamespectroscopy$ from $\attackerpos{p_0,Q_0}$ with $e$.^[
  Proof in Theorem 2 of @bisping2023equivalenceEnergyGamesReport.
]
:::

::: {#thm-clever-strong-spectroscopy-complexity}
Given a transition system $\system=(\states,\actions,\step{})$,
the spectroscopy problem for the simpler $\widehat{\notions}^\literal{strong}$-spectrum is solved by the game approach in $O( \relsize{\states}^{13} \cdot 2^{12\relsize{\states}} )$ time and $O( \relsize{\states} \cdot 2^{\relsize{\states}} )$ space,
:::
:::proof
We instantiate the “flattened” winning budget complexity of @lem-declining-update-complexity-flattened for the case $N=6$ with the size of $\gamespectroscopyclever$ according to @def-strong-spectroscopy-game-clever.

Now, the amount of all game positions is bounded by $\relsize{G_{\blacktriangle}} \in \relsize{\states} \cdot 2^{\relsize{\states}}$.

Concerning the maximal out-degree, now, defender conjunction positions are dominant, $o_{\gamemoveblank_\blacktriangle} \in \bigo{\relsize{\states}}$.

Inserting the parameters in the time bounds of @lem-declining-update-complexity-flattened yields:
$$
\begin{array}{rlccccccc}
    & O( & o_{\gamemoveblank_\blacktriangle} & \cdot & \relsize{G_\blacktriangle}^{2N} & \cdot & (N^2 + 3^{N-1} \cdot N)) \\
  = & O( & (\relsize{\states}) & \cdot & (\relsize{\states} \cdot 2^{\relsize{\states}})^{12} & \cdot & (6^2 + 3^{5} \cdot 6) & ) \\
  = & O( & \relsize{\states}^{13} \cdot 2^{12\relsize{\states}} & ).
\end{array}
$$

For space complexity, only game positions are relevant, $\bigo{ \relsize{G_\blacktriangle} \cdot 3^{N-1} \cdot N } = \bigo{ \relsize{\states} \cdot 2^{\relsize{\states}} }$.
:::

### Instance Games

::: {#def-derived-reachability-game}

Given a declining energy game $\game = (G, G_\defender, \gamemoveblank, w)$,
the *derived reachability game* $\game^R = (G^R, G^R_\defender, \gamemoveblank_R)$ is played on tuples $G^R \defeq G \times (\energies_\infty \cup \{\bot\})$ with $G^R_\defender \defeq G_\defender \times \energies_\infty$.
Lifted moves $(g, e) \gamemoveblank_R (g', e')$ are possible iff
$e \neq \bot$ and if there is $u$ such that $g \gamemove{u} g'$ and $e' = \energyupdate(u, e)$.
(That is: positions with exhausted energies are stuck attacker positions.)
:::



## Discussion

- Mention option of non-perfect attacker information as alternative to subset construction
- Difference to @bjn2022decidingAllBehavioralEqs:
  - Lower exponentiality in conjunctions
  - No explicit construction of formulas